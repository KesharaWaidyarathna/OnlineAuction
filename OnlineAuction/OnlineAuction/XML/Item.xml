<?xml version="1.0" encoding="utf-8" ?>
<Item>
	<GetItemList>
		SELECT * FROM [dbo].[Item]
	</GetItemList>
	<GetItemListByUserId>
		SELECT * FROM [dbo].[Item] WHERE UserID = @UserID
	</GetItemListByUserId>
	<GetItemListByUserBidded>
		SELECT * FROM [dbo].[Item] i INNER JOIN [OnlineAuction].[dbo].[UserBiddingDetails] ubd ON ubd.ItemID = i.ItemID WHERE ubd.UserID = @UserID AND ubd.IsCanceled = 0
	</GetItemListByUserBidded>
	<InsertItem>
		INSERT INTO [dbo].[Item]  VALUES (@Name,@CategoryID,@Description,@Image1,@Image2, @Image3, @Video, @Value, @SoldPrice, @SoldDate,@Location, @IsSold, @UserID)
	</InsertItem>
	<GetItem>
		SELECT * FROM [dbo].[Item] where ItemID = @id
	</GetItem>
	<InsertItemBiddingDetail>
		INSERT INTO [dbo].[ItemBiddingDetails] VALUES (@ItemID,@StartingBid,@StartingDate, @EndingDate,@InspectionStartDate, @InspectionEndDate, @HighestBid)
	</InsertItemBiddingDetail>
	<GetItemBiddingList>
		SELECT * FROM [dbo].[ItemBiddingDetails]
	</GetItemBiddingList>
	<GetItemBiddingListByUser>
		SELECT * FROM [dbo].[ItemBiddingDetails] ibd INNER JOIN [dbo].[Item] i ON ibd.ItemID = i.ItemID WHERE i.UserID = @UserID
	</GetItemBiddingListByUser>
	<GetItemBiddingListByUserBidded>
		SELECT * FROM [dbo].[ItemBiddingDetails] ibd INNER JOIN [dbo].[Item] i ON ibd.ItemID = i.ItemID INNER JOIN [OnlineAuction].[dbo].[UserBiddingDetails] ubd ON ubd.ItemID = i.ItemID WHERE ubd.UserID = @UserID AND ubd.IsCanceled = 0
	</GetItemBiddingListByUserBidded>
	<GetLastItemId>
		SELECT TOP 1 * FROM Item Order By ItemID DESC
	</GetLastItemId>
	<UpdateItemBiddingHighestBid>
		UPDATE [dbo].[ItemBiddingDetails] SET HighestBid = @HighestBid WHERE ItemID = @ItemID
	</UpdateItemBiddingHighestBid>
	<GetHighestBid>
		SELECT * FROM [dbo].[ItemBiddingDetails] WHERE ItemID = @ItemID
	</GetHighestBid>
	<ReadyToDispatch>
		UPDATE [dbo].[Item] SET IsSold = 1 WHERE ItemID = @ItemID
	</ReadyToDispatch>
	<GetReadyToDispatchList>
		SELECT * FROM [dbo].[Item] i INNER JOIN [dbo].[ItemBiddingDetails] ibd ON ibd.ItemID = i.ItemID INNER JOIN [dbo].[UserBiddingDetails] ubd ON i.ItemID = ubd.ItemID INNER JOIN [dbo].[User] u ON u.UserID = ubd.UserID WHERE ibd.HighestBid = ubd.BidValue AND i.IsSold = 1 AND ubd.IsCanceled = 0 AND i.ItemID NOT IN (SELECT ItemID FROM [dbo].[DispatchOrderDetails])
	</GetReadyToDispatchList>
</Item>